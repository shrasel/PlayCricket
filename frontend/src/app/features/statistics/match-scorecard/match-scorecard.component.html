<div class="min-h-screen bg-gray-50 dark:bg-gray-900 py-8">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <!-- Header with Back Button -->
    <div class="mb-6">
      <a routerLink="/statistics" class="inline-flex items-center text-indigo-600 dark:text-indigo-400 hover:text-indigo-700 dark:hover:text-indigo-300 mb-4">
        <svg class="h-5 w-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
        </svg>
        Back to Statistics
      </a>
      <h1 class="text-4xl font-bold text-gray-900 dark:text-white">Match Scorecard</h1>
    </div>

    <!-- Loading State -->
    @if (loading && !match) {
      <div class="flex justify-center items-center py-12">
        <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600"></div>
      </div>
    }

    <!-- Error State -->
    @if (error && !loading) {
      <div class="bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4">
        <div class="flex items-center">
          <svg class="h-5 w-5 text-red-400 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
          <p class="text-red-800 dark:text-red-200">{{ error }}</p>
        </div>
      </div>
    }

    <!-- Match Summary -->
    @if (match && !loading) {
      <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm mb-6">
        <div class="px-6 py-6">
          <!-- Match Info -->
          <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
            <div>
              <p class="text-sm text-gray-500 dark:text-gray-400 mb-1">Match Type</p>
              <p class="text-lg font-semibold text-gray-900 dark:text-white">{{ match.match_type }}</p>
            </div>
            <div>
              <p class="text-sm text-gray-500 dark:text-gray-400 mb-1">Venue</p>
              <p class="text-lg font-semibold text-gray-900 dark:text-white">{{ match.venue?.name || 'N/A' }}</p>
            </div>
            <div>
              <p class="text-sm text-gray-500 dark:text-gray-400 mb-1">Date</p>
              <p class="text-lg font-semibold text-gray-900 dark:text-white">{{ formatDate(match.scheduled_start) }}</p>
            </div>
          </div>

          <!-- Match Result -->
          <div class="bg-gradient-to-r from-indigo-500 to-purple-600 rounded-lg p-4 text-white text-center">
            <p class="text-xl font-bold">{{ getMatchResult() }}</p>
          </div>
        </div>
      </div>

      <!-- Innings Tabs -->
      @if (innings.length > 0) {
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm mb-6">
          <div class="border-b border-gray-200 dark:border-gray-700">
            <nav class="flex -mb-px overflow-x-auto">
              @for (inning of innings; track inning.id; let i = $index) {
                <button
                  (click)="selectInnings(i)"
                  [class.border-indigo-600]="selectedInnings === i"
                  [class.text-indigo-600]="selectedInnings === i"
                  [class.dark:border-indigo-400]="selectedInnings === i"
                  [class.dark:text-indigo-400]="selectedInnings === i"
                  [class.border-transparent]="selectedInnings !== i"
                  [class.text-gray-500]="selectedInnings !== i"
                  [class.dark:text-gray-400]="selectedInnings !== i"
                  class="whitespace-nowrap py-4 px-6 border-b-2 font-medium text-sm hover:text-gray-700 dark:hover:text-gray-300 hover:border-gray-300 dark:hover:border-gray-600 transition-colors"
                >
                  {{ getTeamName(inning.batting_team_id) }} Innings
                  @if (inningsScore && selectedInnings === i) {
                    <span class="ml-2">{{ inningsScore.total_runs }}/{{ inningsScore.total_wickets }}</span>
                  }
                </button>
              }
            </nav>
          </div>
        </div>

        <!-- Innings Score Summary -->
        @if (inningsScore) {
          <div class="grid grid-cols-2 md:grid-cols-5 gap-4 mb-6">
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm p-4">
              <p class="text-sm text-gray-500 dark:text-gray-400 mb-1">Score</p>
              <p class="text-2xl font-bold text-gray-900 dark:text-white">
                {{ inningsScore.total_runs }}/{{ inningsScore.total_wickets }}
              </p>
            </div>
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm p-4">
              <p class="text-sm text-gray-500 dark:text-gray-400 mb-1">Overs</p>
              <p class="text-2xl font-bold text-gray-900 dark:text-white">{{ inningsScore.total_overs }}</p>
            </div>
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm p-4">
              <p class="text-sm text-gray-500 dark:text-gray-400 mb-1">Run Rate</p>
              <p class="text-2xl font-bold text-gray-900 dark:text-white">{{ inningsScore.run_rate.toFixed(2) }}</p>
            </div>
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm p-4">
              <p class="text-sm text-gray-500 dark:text-gray-400 mb-1">All Out</p>
              <p class="text-2xl font-bold text-gray-900 dark:text-white">{{ inningsScore.is_all_out ? 'Yes' : 'No' }}</p>
            </div>
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm p-4">
              <p class="text-sm text-gray-500 dark:text-gray-400 mb-1">Extras</p>
              <p class="text-2xl font-bold text-gray-900 dark:text-white">-</p>
            </div>
          </div>
        }

        <!-- Batting Scorecard -->
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm mb-6">
          <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-700">
            <h2 class="text-lg font-semibold text-gray-900 dark:text-white">Batting</h2>
          </div>
          <div class="overflow-x-auto">
            @if (battingPerformances.length > 0) {
              <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                <thead class="bg-gray-50 dark:bg-gray-900">
                  <tr>
                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">
                      Batsman
                    </th>
                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">
                      Dismissal
                    </th>
                    <th scope="col" class="px-6 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">
                      R
                    </th>
                    <th scope="col" class="px-6 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">
                      B
                    </th>
                    <th scope="col" class="px-6 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">
                      4s
                    </th>
                    <th scope="col" class="px-6 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">
                      6s
                    </th>
                    <th scope="col" class="px-6 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">
                      SR
                    </th>
                  </tr>
                </thead>
                <tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                  @for (performance of battingPerformances; track performance.player.public_id) {
                    <tr class="hover:bg-gray-50 dark:hover:bg-gray-700">
                      <td class="px-6 py-4 whitespace-nowrap">
                        <a [routerLink]="['/statistics/player', performance.player.public_id]" 
                           class="text-sm font-medium text-indigo-600 dark:text-indigo-400 hover:text-indigo-700 dark:hover:text-indigo-300">
                          {{ performance.player.full_name }}
                        </a>
                      </td>
                      <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400">
                        {{ performance.dismissal || 'not out' }}
                      </td>
                      <td class="px-6 py-4 whitespace-nowrap text-center text-sm font-semibold text-gray-900 dark:text-white">
                        {{ performance.runs }}
                      </td>
                      <td class="px-6 py-4 whitespace-nowrap text-center text-sm text-gray-500 dark:text-gray-400">
                        {{ performance.balls }}
                      </td>
                      <td class="px-6 py-4 whitespace-nowrap text-center text-sm text-gray-500 dark:text-gray-400">
                        {{ performance.fours }}
                      </td>
                      <td class="px-6 py-4 whitespace-nowrap text-center text-sm text-gray-500 dark:text-gray-400">
                        {{ performance.sixes }}
                      </td>
                      <td class="px-6 py-4 whitespace-nowrap text-center text-sm text-gray-500 dark:text-gray-400">
                        {{ performance.strike_rate.toFixed(2) }}
                      </td>
                    </tr>
                  }
                </tbody>
              </table>
            } @else {
              <p class="px-6 py-8 text-center text-gray-500 dark:text-gray-400">No batting data available</p>
            }
          </div>
        </div>

        <!-- Bowling Scorecard -->
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm mb-6">
          <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-700">
            <h2 class="text-lg font-semibold text-gray-900 dark:text-white">Bowling</h2>
          </div>
          <div class="overflow-x-auto">
            @if (bowlingPerformances.length > 0) {
              <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                <thead class="bg-gray-50 dark:bg-gray-900">
                  <tr>
                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">
                      Bowler
                    </th>
                    <th scope="col" class="px-6 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">
                      O
                    </th>
                    <th scope="col" class="px-6 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">
                      M
                    </th>
                    <th scope="col" class="px-6 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">
                      R
                    </th>
                    <th scope="col" class="px-6 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">
                      W
                    </th>
                    <th scope="col" class="px-6 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">
                      Econ
                    </th>
                  </tr>
                </thead>
                <tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                  @for (performance of bowlingPerformances; track performance.player.public_id) {
                    <tr class="hover:bg-gray-50 dark:hover:bg-gray-700">
                      <td class="px-6 py-4 whitespace-nowrap">
                        <a [routerLink]="['/statistics/player', performance.player.public_id]" 
                           class="text-sm font-medium text-indigo-600 dark:text-indigo-400 hover:text-indigo-700 dark:hover:text-indigo-300">
                          {{ performance.player.full_name }}
                        </a>
                      </td>
                      <td class="px-6 py-4 whitespace-nowrap text-center text-sm text-gray-500 dark:text-gray-400">
                        {{ performance.overs.toFixed(1) }}
                      </td>
                      <td class="px-6 py-4 whitespace-nowrap text-center text-sm text-gray-500 dark:text-gray-400">
                        {{ performance.maidens }}
                      </td>
                      <td class="px-6 py-4 whitespace-nowrap text-center text-sm text-gray-500 dark:text-gray-400">
                        {{ performance.runs }}
                      </td>
                      <td class="px-6 py-4 whitespace-nowrap text-center text-sm font-semibold text-gray-900 dark:text-white">
                        {{ performance.wickets }}
                      </td>
                      <td class="px-6 py-4 whitespace-nowrap text-center text-sm text-gray-500 dark:text-gray-400">
                        {{ performance.economy.toFixed(2) }}
                      </td>
                    </tr>
                  }
                </tbody>
              </table>
            } @else {
              <p class="px-6 py-8 text-center text-gray-500 dark:text-gray-400">No bowling data available</p>
            }
          </div>
        </div>

        <!-- Fall of Wickets & Run Rate Chart -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
          <!-- Fall of Wickets -->
          <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm">
            <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-700">
              <h2 class="text-lg font-semibold text-gray-900 dark:text-white">Fall of Wickets</h2>
            </div>
            <div class="px-6 py-4">
              @if (fallOfWickets.length > 0) {
                <div class="space-y-3">
                  @for (wicket of fallOfWickets; track wicket.wicketNumber) {
                    <div class="flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-lg">
                      <div class="flex items-center">
                        <div class="h-8 w-8 bg-red-600 rounded-full flex items-center justify-center text-white font-bold text-sm mr-3">
                          {{ wicket.wicketNumber }}
                        </div>
                        <div>
                          <p class="text-sm font-medium text-gray-900 dark:text-white">{{ wicket.playerName }}</p>
                          <p class="text-xs text-gray-500 dark:text-gray-400">{{ wicket.dismissal }}</p>
                        </div>
                      </div>
                      <div class="text-right">
                        <p class="text-sm font-semibold text-gray-900 dark:text-white">{{ wicket.runs }}-{{ wicket.wicketNumber }}</p>
                        <p class="text-xs text-gray-500 dark:text-gray-400">{{ wicket.overs }} ov</p>
                      </div>
                    </div>
                  }
                </div>
              } @else {
                <p class="text-center text-gray-500 dark:text-gray-400 py-8">No wickets fallen</p>
              }
            </div>
          </div>

          <!-- Run Rate Over-by-Over -->
          <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm">
            <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-700">
              <h2 class="text-lg font-semibold text-gray-900 dark:text-white">Run Rate</h2>
            </div>
            <div class="px-6 py-4">
              @if (runRateData.length > 0) {
                <div class="space-y-2 max-h-96 overflow-y-auto">
                  @for (data of runRateData; track data.over) {
                    <div class="flex items-center">
                      <span class="text-xs font-medium text-gray-500 dark:text-gray-400 w-12">Ov {{ data.over }}</span>
                      <div class="flex-1 mx-2">
                        <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2">
                          <div 
                            class="bg-gradient-to-r from-green-600 to-green-500 h-2 rounded-full"
                            [style.width.%]="getRunRateChartHeight(data.runs)">
                          </div>
                        </div>
                      </div>
                      <span class="text-xs font-semibold text-gray-900 dark:text-white w-16 text-right">
                        {{ data.runs }} runs
                      </span>
                    </div>
                  }
                </div>
              } @else {
                <p class="text-center text-gray-500 dark:text-gray-400 py-8">No run rate data available</p>
              }
            </div>
          </div>
        </div>
      } @else {
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm p-8">
          <p class="text-center text-gray-500 dark:text-gray-400">No innings data available for this match</p>
        </div>
      }
    }
  </div>
</div>
